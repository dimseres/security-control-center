# Журнал изменений

## 1.0.6 — 16.02.2026

### Добавлено

#### Settings / Очистка
- Добавлена отдельная вкладка `Settings -> Очистка` (блоки очистки перенесены из `Дополнительно`).
- Очистка локальных данных переведена с одиночного select на выборочный чеклист по модулям.
- Добавлены массовые действия в очистке: `Выбрать все` / `Сбросить`.
- Для операций очистки добавлено внутреннее модальное подтверждение (без browser `confirm()`).

#### Monitoring / Автоматизация
- В `Monitoring -> Settings` добавлен новый чекбокс: `Автоматически закрывать инцидент при доступности монитора`.
- Новый флаг работает server-side и учитывается движком мониторинга при переходе `DOWN -> UP`.
- Значение по умолчанию для нового флага: `выключено`.

### Изменено

#### UX
- Очистка настроек стала выборочной по нескольким модулям за один запуск.
- Подтверждение очистки унифицировано через внутреннее модальное окно приложения.
- Уменьшен размер модального окна подтверждения удаления документа.
- Во вкладке `Monitoring -> Уведомления` добавлен корректный отступ между блоком каналов и блоком истории доставок.
- В фильтрах вкладки `Логи` исправлена верстка диапазона дат (`С` / `По`), чтобы поля не наезжали друг на друга.
- Для неавторизованных переходов на защищенные web-страницы добавлен редирект на `/login` вместо текстового `unauthorized`.

### Исправлено

#### Очистка локальных данных
- Исправлена логика очистки вкладок: теперь реально удаляются соответствующие localStorage-ключи по выбранным модулям.
- Для `Incidents` добавлен runtime-reset пользовательских опций (типы/источники), чтобы очистка срабатывала сразу.
- Сообщение об очистке теперь показывает количество удалённых локальных записей.
- Для модуля `Документы` очистка дополнительно удаляет документы через API (с учетом серверных прав), чтобы очистка вкладки действительно очищала содержимое.
- Для модуля `Инциденты` очистка дополнительно удаляет доступные инциденты через API (закрытые инциденты пропускаются по серверной политике `closedReadOnly`).
- Унифицирован разбор списков очистки для API-ответов форматов `[]` и `{ items: [] }`.

#### Документы
- Исправлен просмотр PDF-документов в редакторе: встроенный просмотр теперь использует `/api/docs/{id}/content`, а не экспортный endpoint.
- Добавлены i18n-ключи ошибок экспортных согласований (`docs.export.approvalRequired`, `docs.export.selfApprovalForbidden`, `docs.export.requesterRequired`).

#### Мониторинг
- Добавлен новый флаг в модель/хранилище настроек мониторинга: `auto_incident_close_on_up`.
- Для PostgreSQL добавлена миграция `00017_monitoring_auto_incident_close_on_up.sql`.
- Для SQLite добавлен auto-migration fallback колонки через `ensureMonitoringColumns`.
- Обновлены тесты автосценариев мониторинга для режимов `вкл/выкл` автозакрытия инцидента.

#### Логи / локализация
- Добавлена локализация action `settings.hardening.read` в ленте логов.
- Улучшен разбор деталей backup-событий: поддерживаются оба формата `key=value` и `key: value`.
- Добавлены переводы деталей `resource` и значения `integrity` для backup-аудита.
- Добавлена локализация действий `doc.export.blocked_policy`, `doc.export.approval.used`, `doc.export.approval.granted`, `doc.security.copy_blocked`, `doc.security.screenshot_attempt`.
- Добавлена локализация причины `approval_required` в деталях document security/export событий.
- Для `settings.hardening.read` деталь `score=...` теперь отображается как локализованное поле оценки.
